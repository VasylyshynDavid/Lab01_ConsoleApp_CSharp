using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Diagnostics;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace Lab11_CircleDemo
{
    public partial class Form1 : Form
    {
        // 1. СПИСОК "БАТЬКІВ" (Поліморфізм)
        private List<CFigure> figures = new List<CFigure>();

        // 2. ПОТОЧНА ОБРАНА "ФІГУРА"
        private CFigure currentFigure = null;

        // 3. Константи
        private const int MoveStep = 10;
        private const int FastMoveStep = 30;
        private const int ResizeStep = 5;

        // 4. Поле для обертання
        private int currentRotation = 0;

        public Form1()
        {
            InitializeComponent(); // <-- Це "оживляє" твій дизайн

            // Налаштовуємо cbFigureType (який є у твоєму дизайнері)
            cbFigureType.SelectedIndex = 0; // Починаємо з "Кола"

            // --- РУЧНЕ ПІДКЛЮЧЕННЯ КНОПОК (ОСЬ ВОНО!) ---
            this.button1.Click += new System.EventHandler(this.button1_Click);
            this.button2.Click += new System.EventHandler(this.button2_Click);
            this.button3.Click += new System.EventHandler(this.button3_Click);
            this.button4.Click += new System.EventHandler(this.button4_Click);
            this.button5.Click += new System.EventHandler(this.button5_Click);
            this.button6.Click += new System.EventHandler(this.button6_Click);
            this.button7.Click += new System.EventHandler(this.button7_Click);
            this.button8.Click += new System.EventHandler(this.button8_Click);
            this.button9.Click += new System.EventHandler(this.button9_Click);
            this.button10.Click += new System.EventHandler(this.button10_Click);
            this.button11.Click += new System.EventHandler(this.button11_Click);
            this.button12.Click += new System.EventHandler(this.button12_Click);
            this.button13.Click += new System.EventHandler(this.button13_Click);
            this.comboBox1.SelectedIndexChanged += new System.EventHandler(this.comboBox1_SelectedIndexChanged);
            this.panel1.Paint += new System.Windows.Forms.PaintEventHandler(this.panel1_Paint);
        }

        // --- МЕТОДИ КЕРУВАННЯ ---
        private void RefreshUI()
        {
            if (comboBox1 != null)
            {
                comboBox1.Items.Clear();
                for (int i = 0; i < figures.Count; i++)
                {
                    // Додаємо тип фігури у список
                    string typeName = figures[i] is CCircle ? "Коло" : "Трикутник";
                    comboBox1.Items.Add($"Фігура №{i + 1} [{typeName}]");
                }
            }
            if (panel1 != null)
            {
                panel1.Refresh();
            }
        }

        private void panel1_Paint(object sender, PaintEventArgs e)
        {
            if (panel1 != null)
            {
                e.Graphics.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;
                // Малюємо КОЖНУ фігуру, яка видима
                foreach (var figure in figures)
                {
                    if (figure.IsVisible)
                    {
                        figure.Draw(e.Graphics);
                    }
                }
            }
        }

        // --- ОБРОБНИКИ ПОДІЙ КНОПОК ---

        // 1. Кнопка "Створити новий об'єкт" (button1)
        private void button1_Click(object sender, EventArgs e)
        {
            int size = 80;
            int x = panel1.Width / 2;
            int y = panel1.Height / 2;
            int angle = currentRotation;
            currentRotation += 45;

            CFigure newFigure = null;

            // --- ПОЛІМОРФІЗМ В ДІЇ ---
            if (cbFigureType.SelectedIndex == 0) // Якщо обрано "Коло"
            {
                newFigure = new CCircle(x, y, size, angle);
            }
            else // Якщо обрано "Трикутник"
            {
                newFigure = new CTriangle(x, y, size, angle);
            }

            figures.Add(newFigure);
            RefreshUI();

            if (figures.Count > 0)
            {
                comboBox1.SelectedIndex = figures.Count - 1;
            }
        }

        // 2. Кнопка "Приховати об'єкт" (button2)
        private void button2_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Hide();
                panel1.Refresh();
            }
        }

        // 3. Кнопка "Показати об'єкт" (button3)
        private void button3_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Show();
                panel1.Refresh();
            }
        }

        // 4. Кнопка Збільшити "+" (button4)
        private void button4_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Expand(ResizeStep);
                panel1.Refresh();
            }
        }

        // 5. Кнопка Зменшити "-" (button5)
        private void button5_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.collapse(ResizeStep);
                panel1.Refresh();
            }
        }

        // 6. Кнопка Вгору (button6)
        private void button6_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(0, -MoveStep);
                panel1.Refresh();
            }
        }

        #region Handlers for Move buttons (7-13)
        // 7. Кнопка Швидко Вгору (button7)
        private void button7_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(0, -FastMoveStep);
                panel1.Refresh();
            }
        }

        // 8. Кнопка Вниз (button8)
        private void button8_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(0, MoveStep);
                panel1.Refresh();
            }
        }

        // 9. Кнопка Швидко Вниз (button9)
        private void button9_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(0, FastMoveStep);
                panel1.Refresh();
            }
        }

        // 10. Кнопка Вліво (button10)
        private void button10_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(-MoveStep, 0);
                panel1.Refresh();
            }
        }

        // 11. Кнопка Швидко Вліво (button11)
        private void button11_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(-FastMoveStep, 0);
                panel1.Refresh();
            }
        }

        // 12. Кнопка Вправо (button12)
        private void button12_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(MoveStep, 0);
                panel1.Refresh();
            }
        }

        // 13. Кнопка Швидко Вправо (button13)
        private void button13_Click(object sender, EventArgs e)
        {
            if (currentFigure != null)
            {
                currentFigure.Move(FastMoveStep, 0);
                panel1.Refresh();
            }
        }
        #endregion

        // Вибір у ComboBox ('comboBox1')
        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        {
            int index = comboBox1.SelectedIndex;
            if (index >= 0 && index < figures.Count)
            {
                currentFigure = figures[index];
            }
        }

        // Подія завантаження форми
        private void Form1_Load(object sender, EventArgs e)
        {
            if (panel1 != null)
            {
                panel1.BorderStyle = BorderStyle.FixedSingle;
            }
        }
    }
}